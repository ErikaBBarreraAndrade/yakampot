{%- liquid
	assign on_sale = false
	if product.compare_at_price > product.price
		assign on_sale = true
	endif
	assign sold_out = true
	if product.available
		assign sold_out = false
	endif
	assign product_tags = product.tags | join: ','
	assign has_custom_label = false
	if product_tags contains '_label_'
		for tag in product.tags
			if tag contains '_label_'
				assign tag_starts_with = tag | slice: 0
				if tag_starts_with == '_'
					assign has_custom_label = true
					assign custom_label = tag | replace: '_label_', ''
				endif
			endif
		endfor
	endif
-%}
{% comment %}
Added/Modified by Limoni Apps on 8th-march-2022 to support Discount Ninja
The data tags below are used by Limoni Apps Discount Ninja to provide information
to the app about the products displayed in the collection.
{% endcomment %}
<link rel="preload" href="{{ 'grid-items-collection.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'grid-items-collection.css' | asset_url }}"></noscript>
<div class="grid__item grid-product col-12 col-sm-6 col-md-4 {% if section.settings.enable_columns%}content-columns-small{% else %}col-lg-4 col-xl-3 p-0{%endif%}{% if settings.quick_shop_enable and sold_out == false %} grid-product__has-quick-shop{% endif %}"
                     data-price="{{product.price}}" data-aos="row-of-{{ per_row }}" data-product-handle="{{ product.handle }}"
                     data-limoniapps-discountninja-product-handle="{{ product.handle }}"
                     data-limoniapps-discountninja-product-collections="{{ product.collections | map: 'handle' | join: ',' }}"
                     data-limoniapps-discountninja-product-collectionids="{{ product.collections | map: 'id' | join: ',' }}"
                     data-limoniapps-discountninja-product-available="{{ product.available}}"
                     data-limoniapps-discountninja-product-price="{{ product.first_available_variant.price}}"
                     data-limoniapps-discountninja-product-compareatprice="{{ product.first_available_variant.compare_at_price}}"
                     data-limoniapps-discountninja-product-pricevaries="{{ product.price_varies}}"
                     data-limoniapps-discountninja-product-pricemin="{{ product.price_min}}"
                     data-limoniapps-discountninja-product-tags="{{ product.tags | join: ',' }}"
>
	<div class="grid-product__content">

		{%- liquid
			assign fixed_aspect_ratio = false
			unless settings.product_grid_image_size == 'natural'
				assign fixed_aspect_ratio = true
			endunless

			assign preview_image = product.featured_media.preview_image
			assign img_url = preview_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.'
		-%}
		<div class="quick-product__btn quick-view-button"><a class="quick-view" data-handle="{{ product.handle }}" href="javascript:void(0);">{{ settings.quick_shop_text }}</a>
		</div>
		<a href="{{ product.url | within: collection }}" class="grid-product__link{% if sold_out %} grid-product__link--disabled{% endif %}">
			<div class="grid-product__image-mask">
				{%- if has_custom_label -%}
					<div class="grid-product__tag grid-product__tag--custom">
						{{ custom_label }}
					</div>
				{%- else -%}
					{%- if sold_out -%}
						<div class="grid-product__tag grid-product__tag--sold-out">
							{{ 'products.product.sold_out' | t }}
						</div>
					{%- endif -%}
					{%- if on_sale and sold_out == false -%}
						<div class="grid-product__tag grid-product__tag--sale">
							{{ 'products.general.sale' | t }}
						</div>
					{%- endif -%}
				{%- endif -%}
				<!--         {%- if settings.quick_shop_enable and sold_out == false -%}
          <div class="quick-product__btn quick-product__btn--not-ready js-modal-open-quick-modal-{{ product.id }} small--hide" data-product-id="{{ product.id }} ">
            <span class="quick-product__label">{{ settings.quick_shop_text }}</span>
          </div>
        {%- endif -%} -->
				{%- if fixed_aspect_ratio -%}
					<div
						class="grid__image-ratio grid__image-ratio--{{ settings.product_grid_image_size }} lazyload"
						data-bgset="{% render 'bgset', image: preview_image %}"
						data-sizes="auto">
					</div>
				{%- else -%}
					<div class="image-wrap "
					     style="height: 0; padding-bottom: {{ 100 | divided_by: preview_image.aspect_ratio }}%;"
					>
						<img class="grid-product__image lazyload"
						     data-src="{{ img_url }}"
						     data-widths="[180, 360, 540, 720, 900, 1080]"
						     data-aspectratio="{{ preview_image.aspect_ratio }}"
						     data-sizes="auto"
						     alt="{{ preview_image.alt | escape }}">
						<noscript>
							<img class="grid-product__image lazyloaded"
							     src="{{ preview_image | img_url: '400x' }}"
							     alt="{{ preview_image.alt | escape }}">
						</noscript>
					</div>
				{%- endif -%}

				{%- unless sold_out -%}
					{%- if settings.product_hover_image and product.media.size > 1 -%}
						{%- for media in product.media offset: 1 limit: 1 -%}
							{%- assign second_image = media.preview_image -%}
						{%- endfor -%}
						<div
							class="grid-product__secondary-image small--hide lazyload"
							data-bgset="{% render 'bgset', image: second_image %}"
							data-sizes="auto">
						</div>
					{%- endif -%}
				{%- endunless -%}

				{%- if settings.collection_color_swatches -%}
					{%- assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase-%}
					{%- for option in product.options_with_values -%}
						{%- liquid
							assign option_name = option.name | downcase
							assign is_color = false
							if option_name contains swatch_trigger
								assign is_color = true
							elsif swatch_trigger == 'color' and option_name contains 'colour'
								assign is_color = true
							endif
						-%}
						{%- if is_color -%}
							{%- assign option_index = forloop.index0 -%}
							{%- assign values = '' -%}
							{%- for variant in product.variants -%}
								{%- assign value = variant.options[option_index] %}
								{%- unless values contains value -%}
									{%- liquid
										assign values = values | join: ','
										assign values = values | append: ',' | append: value
										assign values = values | split: ','
									-%}

									{%- if variant.image -%}
										<div
											class="grid-product__color-image grid-product__color-image--{{ variant.id }} small--hide">
										</div>
									{%- endif -%}
								{%- endunless -%}
							{%- endfor -%}
						{%- endif -%}
					{%- endfor -%}
				{%- endif -%}
			</div>

			<div class="grid-product__meta">
				<div class="grid-product__title grid-product__title--{{ settings.type_product_style }}">{{ product.title }}</div>
				{%- if settings.vendor_enable -%}
					<div class="grid-product__vendor">{{ product.vendor }}</div>
				{%- endif -%}
				{% comment %}
				Added/Modified by Limoni Apps on 8th-march-2022 to support Discount Ninja
				The data tags below are used by Limoni Apps Discount Ninja to provide information
				to the app about the products displayed in the collection.
				{% endcomment %}        <div class="grid-product__price limoniapps-discountninja-productprice limoniapps-discountninja-align-center">
					{%- if on_sale -%}
						<span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
						<span class="grid-product__price--original">{{ product.compare_at_price | money }}</span>
						<span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>
					{%- endif -%}
					{%- if product.price_varies -%}
						{%- assign price = product.price_min | money -%}
						{{ 'products.general.from_text_html' | t: price: price }}
					{%- else -%}
						{{ product.price  | money }}
					{%- endif -%}
					{%- if on_sale -%}
						{%- if settings.product_save_amount -%}
							{%- if settings.product_save_type == 'dollar' -%}
								{%- capture saved_amount -%}{{ product.compare_at_price | minus: product.price | money }}{%- endcapture -%}
							{%- else -%}
								{%- capture saved_amount -%}{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}%{%- endcapture -%}
							{%- endif -%}
							<span class="grid-product__price--savings">
                {{ 'products.general.save_html' | t: saved_amount: saved_amount }}
              </span>
						{%- endif -%}
					{%- endif -%}

					{%- assign product_variant = product.selected_or_first_available_variant -%}
					{%- if product_variant.unit_price_measurement -%}
						<div class="product__unit-price">
							{%- capture unit_price_base_unit -%}
								{%- if product_variant.unit_price_measurement -%}
									{%- if product_variant.unit_price_measurement.reference_value != 1 -%}
										{{ product_variant.unit_price_measurement.reference_value }}
									{%- endif -%}
									{{ product_variant.unit_price_measurement.reference_unit }}
								{%- endif -%}
							{%- endcapture -%}

							{{ product_variant.unit_price | money }}/{{ unit_price_base_unit }}
						</div>
					{%- endif -%}
				</div>
				<div data-fera-container="504944" data-product_id="{{ product.id }}" class="content-global-fera-reviews"></div>
				<span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
			</div>
			{% render 'banana-stand-product-list-container', product: product %}
		</a>
	</div>
	{%- if settings.collection_color_swatches -%}
		{%- liquid
			assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase
			assign swatch_file_extension = 'png'
			assign color_count = 0
		-%}

		{%- for option in product.options_with_values -%}
			{%- liquid
				assign option_name = option.name | downcase
				assign is_color = false
				if option_name contains swatch_trigger
					assign is_color = true
				elsif swatch_trigger == 'color' and option_name contains 'colour'
					assign is_color = true
				endif
			-%}
			{%- if is_color -%}
				{%- assign option_index = forloop.index0 -%}
				{%- assign values = '' -%}
				<div class="grid-product__colors grid-product__colors--{{ product.id }}">
					{%- for variant in product.variants -%}
						{%- assign value = variant.options[option_index] %}
						{%- unless values contains value -%}
							{%- liquid
								assign values = values | join: ','
								assign values = values | append: ',' | append: value
								assign values = values | split: ','

								assign color_image = value | handle | append: '.' | append: swatch_file_extension | asset_img_url: '50x' | prepend: 'https:' | split: '?' | first
								assign color_swatch_fallback = value | split: ' ' | last | handle
								assign color_count = color_count | plus: 1
							-%}

							<a
								href="{{ variant.url | within: collection }}"
								class="color-swatch color-swatch--small color-swatch--{{ value | handle }}{% if variant.image %} color-swatch--with-image{% endif %}"
								{% if variant.image %}
									data-variant-id="{{ variant.id }}"
									data-variant-image="{{ variant.image | img_url: '400x' }}"
								{% endif %}
								style="background-image: url({{ color_image }}); background-color: {{ color_swatch_fallback }};">
								<span class="visually-hidden">{{ value }}</span>
							</a>
						{%- endunless -%}
					{%- endfor -%}
				</div>
				{%- if color_count < 2 -%}
					{%- style -%}
						.grid-product__colors--{{ product.id }} {
						display: none;
						}
					{%- endstyle -%}
				{%- endif -%}
			{%- endif -%}
		{%- endfor -%}
	{%- endif -%}
</div>

